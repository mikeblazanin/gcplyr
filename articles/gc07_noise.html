<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dealing with noise • gcplyr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dealing with noise">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">gcplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.12.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/gc01_gcplyr.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/gc02_import_reshape.html">Importing and reshaping data</a></li>
    <li><a class="dropdown-item" href="../articles/gc03_incorporate_designs.html">Incorporating experimental designs</a></li>
    <li><a class="dropdown-item" href="../articles/gc04_preprocess_plot.html">Pre-processing and plotting data</a></li>
    <li><a class="dropdown-item" href="../articles/gc05_process.html">Processing data</a></li>
    <li><a class="dropdown-item" href="../articles/gc06_analyze.html">Analyzing data</a></li>
    <li><a class="dropdown-item" href="../articles/gc07_noise.html">Dealing with noise</a></li>
    <li><a class="dropdown-item" href="../articles/gc08_conclusion.html">Best practices and other tips</a></li>
    <li><a class="dropdown-item" href="../articles/gc09_multiple_plates.html">Working with multiple plates</a></li>
    <li><a class="dropdown-item" href="../articles/gc10_using_make_design.html">Using make_design to generate experimental designs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mikeblazanin/gcplyr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dealing with noise</h1>
                        <h4 data-toc-skip class="author">Mike
Blazanin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikeblazanin/gcplyr/blob/v1.12.0/vignettes/gc07_noise.Rmd" class="external-link"><code>vignettes/gc07_noise.Rmd</code></a></small>
      <div class="d-none name"><code>gc07_noise.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="where-are-we-so-far">Where are we so far?<a class="anchor" aria-label="anchor" href="#where-are-we-so-far"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Introduction: <code><a href="../articles/gc01_gcplyr.html">vignette("gc01_gcplyr")</a></code>
</li>
<li>Importing and reshaping data:
<code><a href="../articles/gc02_import_reshape.html">vignette("gc02_import_reshape")</a></code>
</li>
<li>Incorporating experimental designs:
<code><a href="../articles/gc03_incorporate_designs.html">vignette("gc03_incorporate_designs")</a></code>
</li>
<li>Pre-processing and plotting your data:
<code><a href="../articles/gc04_preprocess_plot.html">vignette("gc04_preprocess_plot")</a></code>
</li>
<li>Processing your data: <code><a href="../articles/gc05_process.html">vignette("gc05_process")</a></code>
</li>
<li>Analyzing your data: <code><a href="../articles/gc06_analyze.html">vignette("gc06_analyze")</a></code>
</li>
<li>
<strong>Dealing with noise:</strong>
<code><a href="../articles/gc07_noise.html">vignette("gc07_noise")</a></code>
</li>
<li>Best practices and other tips:
<code><a href="../articles/gc08_conclusion.html">vignette("gc08_conclusion")</a></code>
</li>
<li>Working with multiple plates:
<code><a href="../articles/gc09_multiple_plates.html">vignette("gc09_multiple_plates")</a></code>
</li>
<li>Using make_design to generate experimental designs:
<code><a href="../articles/gc10_using_make_design.html">vignette("gc10_using_make_design")</a></code>
</li>
</ol>
<p>So far, we’ve imported and transformed our measures, combined them
with our design information, pre-processed, processed, plotted, and
analyzed our data. Here, we’re going to learn potential strategies for
dealing with noise in our growth curve data.</p>
<p>If you haven’t already, load the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mikeblazanin.github.io/gcplyr/">gcplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ## </span></span>
<span><span class="co">#&gt; ## gcplyr (Version 1.12.0, Build Date: 2025-07-28)</span></span>
<span><span class="co">#&gt; ## See http://github.com/mikeblazanin/gcplyr for additional documentation</span></span>
<span><span class="co">#&gt; ## Please cite software as:</span></span>
<span><span class="co">#&gt; ##   Blazanin, Michael. gcplyr: an R package for microbial growth</span></span>
<span><span class="co">#&gt; ##   curve data analysis. BMC Bioinformatics 25, 232 (2024).</span></span>
<span><span class="co">#&gt; ##   https://doi.org/10.1186/s12859-024-05817-3</span></span>
<span><span class="co">#&gt; ##</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Oftentimes, growth curve data produced by a plate reader will have
some noise in it. Since <code>gcplyr</code> does model-free analyses,
our approach can sometimes be sensitive to noise, necessitating steps to
reduce the effects of noise.</p>
<p>When assessing the effects of noise in our data, one of the first
steps is simply to visualize our data, including both the raw data and
any derivatives we’ll be analyzing. This is especially important because
per-capita derivatives can be very sensitive to noise, especially when
density is low. By visualizing our data, we can assess whether the noise
we see is likely to throw off our analyses.</p>
<p>Broadly speaking, there are three strategies we can use to deal with
noise.</p>
<ol style="list-style-type: decimal">
<li><a href="#SubsetAnalysis">Excluding low-density data points</a></li>
<li><a href="#FittingDeriv">Using fitting during derivative
calculations</a></li>
<li><a href="#Smoothing">Smoothing the raw data</a></li>
</ol>
<p>Each approach is progressively more involved, so I recommend trying
them out in that order. Typically, noise is most problematic in the
derivatives, and all three approaches will help with that. However, if
you’re dealing with substantial noise in your raw density data, only
approach #3 will help.</p>
<p>Let’s start by pulling out some example data. The example data here
is the same example data we’ve been working with, along with a version
of that data with simulated noise added to it.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_example.html">make_example</a></span><span class="op">(</span>vignette <span class="op">=</span> <span class="fl">7</span>, example <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with a log y-axis</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_continuous(trans = "log10"): <span style="color: #00BB00;">log-10</span></span></span>
<span><span class="co">#&gt; transformation introduced infinite values.</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>Great! Here we can see how the noisy (points) and noiseless (red
line) data compare. We’ve plotted our data with log-transformed y-axes,
which are useful because exponential growth is a straight line when
plotted on a log scale. log axes also reveal another common pattern:
<strong>random noise tends to have a much larger effect at low
densities</strong>.</p>
<p>This level of noise doesn’t seem like it would mess up calculations
of maximum density or area under the curve much, so that’s not enough of
a reason to smooth. But let’s look at what our derivatives look
like.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>         deriv_2 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span>,</span>
<span>         derivpercap_2 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                   percapita <span class="op">=</span> <span class="cn">TRUE</span>, blank <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">deriv_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot per-capita derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">derivpercap_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span>
<span><span class="co">#&gt; Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<p>Those values are jumping all over the place! Let’s see what we can do
to address this.</p>
</div>
<div class="section level2">
<h2 id="SubsetAnalysis">Summarizing on subsets of derivatives<a class="anchor" aria-label="anchor" href="#SubsetAnalysis"></a>
</h2>
<p>One strategy we can employ when dealing with noisy data is excluding
data points where the density is near 0. If we compare our per-capita
growth rates and our density plots, we’ll see that most of the noise
occurs when the density is very close to 0:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Plot density</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot per-capita derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">derivpercap_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
<p>Per-capita growth rates are often very noisy when the density is
close to 0, so it can make sense to simply exclude those data
points.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Plot density</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span>, <span class="va">Measurements</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.01</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Plot per-capita derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span>, <span class="va">Measurements</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">derivpercap_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 3 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_point()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-4-2.png" width="700"></p>
<p>When we limit our analysis to data points where the density is not
too close to 0, much of the noise in our per-capita derivative
disappears.</p>
<p>To take this to the final step, we can use these cutoffs in our
<code>summarize</code> commands to calculate the maximum growth rate of
the bacteria when their density is at least 0.01.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg_sum</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>            max_growth_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">derivpercap_2</span><span class="op">[</span><span class="va">Measurements</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">]</span>, </span>
<span>                                  na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'Well', 'Bacteria_strain', 'Phage'. You can</span></span>
<span><span class="co">#&gt; override using the `.groups` argument.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex_dat_mrg_sum</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Well, Bacteria_strain, Phage [3]</span></span></span>
<span><span class="co">#&gt;   Well  Bacteria_strain Phage       noise max_growth_rate</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A1    Strain 1        No Phage    No               1.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> A1    Strain 1        No Phage    Yes              2   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> E11   Strain 29       Phage Added No               2.11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> E11   Strain 29       Phage Added Yes             12.3 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> F1    Strain 31       No Phage    No               0.8 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> F1    Strain 31       No Phage    Yes              1.75</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="FittingDeriv">Fitting during derivative calculation<a class="anchor" aria-label="anchor" href="#FittingDeriv"></a>
</h2>
<p>The next approach to try is to calculate derivatives by fitting a
line to multiple points. (You might recall we previously used this in
the Calculating Derivatives article
<code><a href="../articles/gc05_process.html">vignette("gc05_process")</a></code>.)</p>
<p>To use the fitting functionality of <code>calc_deriv</code>, specify
the width of the moving window using <code>window_width</code>,
<code>window_width_n</code>, <code>window_width_frac</code>, or
<code>window_width_n_frac</code>. Wider windows will be more
smoothed.</p>
<p>Fitting using a moving window is subject to a trade off between the
amount of variance (noise) that remains and the amount of bias added to
your data. A small window will allow higher variance but add little
bias, while a wide window will allow less variance but add more
bias.</p>
<p>Thus, I recommend using as small a window as possible, like
<code>window_width_n = 3</code> or <code>window_width_n = 5</code>. The
best way to figure out what values to use for your data are to try
different window widths and plot the results, then choose the smallest
one that is sufficient for your analyses to succeed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>         deriv_5 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                            window_width_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>         derivpercap_5 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                   percapita <span class="op">=</span> <span class="cn">TRUE</span>, blank <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                   window_width_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>         deriv_9 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                            window_width_n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>         derivpercap_9 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                   percapita <span class="op">=</span> <span class="cn">TRUE</span>, blank <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                   window_width_n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Reshape our data for plotting purposes</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"deriv"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deriv"</span>, <span class="st">"window_width_n"</span><span class="op">)</span>, names_sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, names_from <span class="op">=</span> <span class="va">deriv</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span>                               </span>
<span><span class="co">#Plot derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">deriv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">window_width_n</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, </span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">window_width_n</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 13 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>       </span>
<span><span class="co">#Plot per-capita derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">derivpercap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">window_width_n</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>,</span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">window_width_n</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 14 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>As we can see, increasing the width of the window reduces the effects
of noise, getting us closer to the noiseless data (red line). However,
it also starts making peaks shorter and valleys shallower. Finding the
right width that balances those two effects is the key to choosing the
right <code>window_width</code>.</p>
</div>
<div class="section level2">
<h2 id="Smoothing">Smoothing raw data<a class="anchor" aria-label="anchor" href="#Smoothing"></a>
</h2>
<p>The final approach to dealing with noise is to smooth the raw density
data. <code>gcplyr</code> has a <code>smooth_data</code> function that
can carry out such smoothing. <code>smooth_data</code> has five
different smoothing algorithms to choose from:
<code>moving-average</code>, <code>moving-median</code>,
<code>loess</code>, <code>gam</code>, and
<code>smooth.spline</code>.</p>
<ul>
<li>
<code>moving-average</code> and <code>moving-median</code> are
simple smoothing algorithms that primarily act to reduce the effects of
outliers on the data</li>
<li>
<code>loess</code>, <code>gam</code>, and <code>smooth.spline</code>
are spline-fitting approaches that use polynomial-like curves, which
produces curves with smoothly changing derivatives, but can in some
cases create curvature artifacts not present in the original data</li>
</ul>
<p>Generally, I recommend sticking to the first two algorithms, alone or
in combination, since the others tend to add artifacts to the
derivatives of growth curve data.</p>
<p><strong>Regardless of which smoothing algorithm you use, you will
need to set a tuning parameter</strong> that controls how “smoothed” the
data are. That choice is subject to a trade off between the amount of
variance (noise) that remains and the amount of bias added to your data.
Choosing a value that smooths your data less will allow higher variance
but will add little bias to your data, while choosing a value that
smooths your data more will allow less variance but add more bias to
your data. Because of this, I generally recommend choosing the value
that smooths your data as little as necessary for your analyses to work.
For more details, see the <a href="#ChoosingTuningParams">Choosing
tuning parameter values</a> section.</p>
<p>Additionally, when sharing your findings, it’s important to be
transparent by sharing the raw data and smoothing methods, rather than
presenting the smoothed data as your source.</p>
<p>To use <code>smooth_data</code>, pass your x and y values, your
method of choice, and any additional arguments needed for the method. It
will return a vector of your smoothed y values.</p>
<div class="section level3">
<h3 id="smoothing-with-moving-median">Smoothing with moving-median<a class="anchor" aria-label="anchor" href="#smoothing-with-moving-median"></a>
</h3>
<p>For <code>moving-median</code>, specify the width of the moving
window using <code>window_width</code>, <code>window_width_n</code>,
<code>window_width_frac</code>, or <code>window_width_n_frac</code>.
Wider windows will be more smoothed. Here, we’ll show moving medians
with windows that are 5 and 9 data points wide (<code>movemed_1</code>
is just our raw, unsmoothed data).</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>         movmed_1 <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>         movmed_5 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>         movmed_9 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Reshape our data for plotting purposes</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"movmed"</span><span class="op">)</span>,</span>
<span>               names_prefix <span class="op">=</span> <span class="st">"movmed_"</span>, names_to <span class="op">=</span> <span class="st">"window_width_n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">window_width_n</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>,</span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">window_width_n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"moving-median"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Here we can see that <code>moving-median</code> has done a great job
excluding noise without biasing our data very far from the true values
(red line). However, it has produced a smoothed density that is fairly
“jumpy”, something that is common with moving-median. To address this,
you often will need to combine <code>moving-median</code> with other
smoothing methods.</p>
</div>
<div class="section level3">
<h3 id="smoothing-with-moving-average">Smoothing with moving-average<a class="anchor" aria-label="anchor" href="#smoothing-with-moving-average"></a>
</h3>
<p>For <code>moving-average</code>, specify the width of the moving
window using <code>window_width</code>, <code>window_width_n</code>,
<code>window_width_frac</code>, or <code>window_width_n_frac</code>.
Wider windows will be more smoothed. Here, we’ll show moving averages
with <code>window_width_n</code> values of 5 or 9 data points wide
(<code>movavg_1</code> is just our raw, unsmoothed data).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>         movavg_1 <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>         movavg_5 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>              sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>         movavg_9 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>              sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Reshape our data for plotting purposes</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"movavg"</span><span class="op">)</span>,</span>
<span>               names_prefix <span class="op">=</span> <span class="st">"movavg_"</span>, names_to <span class="op">=</span> <span class="st">"window_width_n"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">window_width_n</span><span class="op">)</span>, linewidth <span class="op">=</span> <span class="fl">0.6</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>,</span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">window_width_n</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"moving-average"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 12 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Here we can see that <code>moving-average</code> has helped reduce
the effects of some of that early noise. However, as the window width
gets larger, it starts biasing our data more strongly
[e.g. underrepresenting the maximum density peaks relative to the true
value (red line)].</p>
</div>
<div class="section level3">
<h3 id="combining-multiple-smoothing-methods">Combining multiple smoothing methods<a class="anchor" aria-label="anchor" href="#combining-multiple-smoothing-methods"></a>
</h3>
<p>Often, combining multiple smoothing methods can provide improved
results. For instance, <code>moving-median</code> is particularly good
at removing outliers, but not very good at producing smoothly changing
data. In contrast, <code>moving-average</code> works well at producing
smoothly changing data, but isn’t as good at removing outliers. Often,
we can get the best of both by using <code>moving-median</code> first,
followed by <code>moving-average</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>         smoothed_no <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>         sm_med3 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>         <span class="co">#Note that for the second round, we're using the </span></span>
<span>         <span class="co">#first smoothing as the input y</span></span>
<span>         smoothed_yes <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">sm_med3</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Reshape our data for plotting purposes</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"smoothed"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="st">"smoothed"</span>, names_prefix <span class="op">=</span> <span class="st">"smoothed_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">smoothed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.6</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>,</span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">smoothed</span> <span class="op">==</span> <span class="st">"no"</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"median then average smoothing"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in scale_y_log10(): <span style="color: #00BB00;">log-10</span> transformation introduced</span></span>
<span><span class="co">#&gt; infinite values.</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Here we can see that the combination of minimal
<code>moving-median</code> and <code>moving-average</code> smoothing has
produced a curve that has most of the noise removed with minimal
introduction of bias relative to the true values (red line).</p>
</div>
<div class="section level3">
<h3 id="smoothing-with-other-methods">Smoothing with other methods<a class="anchor" aria-label="anchor" href="#smoothing-with-other-methods"></a>
</h3>
<p>I typically recommend against using other smoothing algorithms, since
they have a tendency to add artifacts to the derivatives of growth curve
data. However, they may work for your analyses, so if you are
considering using them make sure to plot the smoothed output to check
for any introduced artifacts.</p>
<p>For <code>loess</code>, the tuning parameter is the <code>span</code>
argument. <code>loess</code> works by doing fits on subset windows of
the data centered at each data point. <code>span</code> is the width of
the window, as a fraction of all data points. <code>span</code> values
typically are between 0 and 1, and larger values are more “smoothed”.
The fits can be linear (<code>degree = 1</code>) or polynomial
(typically <code>degree = 2</code>).</p>
<p>For <code>gam</code>, the primary tuning parameter is the
<code>k</code> argument. <code>gam</code> works by doing fits on subsets
of the data and linking these fits together. <code>k</code> determines
how many link points (“knots”) it can use. If not specified, the default
<code>k</code> value for smoothing a time series is 10, with smaller
values being more “smoothed”. However, unlike earlier methods,
<code>k</code> values that are too large are also problematic, as they
will tend to ‘overfit’ the data.</p>
<p>For <code>smooth.spline</code>, the primary tuning parameters are
<code>df</code> and <code>spar</code>. <code>df</code> is the number of
degrees of freedom, and must be between 1 and the number of unique x
values. <code>spar</code> is the smoothing parameter, and is typically
between 0 and 1.</p>
</div>
<div class="section level3">
<h3 id="ChoosingTuningParams">Choosing tuning parameter values<a class="anchor" aria-label="anchor" href="#ChoosingTuningParams"></a>
</h3>
<p>Given that smoothing reduces the variance of your data but adds bias,
how can you know the right value of the tuning ‘smoothness’ parameter
for your data?</p>
<p>One way you can choose is by trying smoothing with different tuning
parameter values, plotting the results, and then choosing the one that
smooths your data as little as necessary for your analyses to work. This
approach is especially useful if you’re trying to deal with noise that
is most strongly affecting your derivatives.</p>
<p>An alternative way is to use cross-validation to attempt to estimate
the best smoothing parameter value. Cross-validation works by randomly
splitting the data into blocks of roughly equal size, leaving out one
block and smoothing the data, then seeing how close the smoothed values
are to the left-out data, reporting the average error across all the
blocks. We can then repeat this whole process at different values of the
smoothing parameter, testing which smoothing parameter value gives us
the lowest error. Note, however, that this approach doesn’t quantify how
well the smoothing improved your derivatives.</p>
<p>To do cross-validation of smoothing parameters, use
<code>train_smooth_data</code>. <code>train_smooth_data</code> works
similar to <code>smooth_data</code>, except that instead of returning
the smoothed data values, it returns the average accuracy metrics.
Because of this, we have to use <code>train_smooth_data</code> within
the <code>dplyr</code> function <code>reframe</code>, which works like
<code>summarize</code> except that it allows multiple rows to be
returned.</p>
<p>By default, <code>train_smooth_data</code> will test an evenly spaced
grid of three values of the smoothing parameter. Usually, that’s not
enough values, so you’ll want to set the number of values to test with
<code>tuneLength</code> (more values will take longer to calculate).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg_fortraining</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_example.html">make_example</a></span><span class="op">(</span>vignette <span class="op">=</span> <span class="fl">7</span>, example <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">training_results</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg_fortraining</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">Well</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/train_smooth_data.html">train_smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>, </span>
<span>                   sm_method <span class="op">=</span> <span class="st">"moving-average"</span>,</span>
<span>                   tuneLength <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: lattice</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">training_results</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">#&gt;   Bacteria_strain Phage    Well  window_width_n    RMSE Rsquared     MAE  RMSESD</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Strain 1        No Phage A1                 1 0.010<span style="text-decoration: underline;">4</span>     0.999 0.004<span style="text-decoration: underline;">95</span> 0.013<span style="text-decoration: underline;">8</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Strain 1        No Phage A1                 3 0.008<span style="text-decoration: underline;">63</span>    1.000 0.004<span style="text-decoration: underline;">84</span> 0.008<span style="text-decoration: underline;">15</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Strain 1        No Phage A1                 7 0.010<span style="text-decoration: underline;">6</span>     1.000 0.007<span style="text-decoration: underline;">07</span> 0.007<span style="text-decoration: underline;">49</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Strain 1        No Phage A1                 9 0.012<span style="text-decoration: underline;">4</span>     0.999 0.008<span style="text-decoration: underline;">60</span> 0.006<span style="text-decoration: underline;">47</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Strain 1        No Phage A1                13 0.017<span style="text-decoration: underline;">9</span>     0.999 0.012<span style="text-decoration: underline;">8</span>  0.006<span style="text-decoration: underline;">26</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Strain 1        Phage A… A7                 1 0.024<span style="text-decoration: underline;">2</span>     0.886 0.012<span style="text-decoration: underline;">3</span>  0.035<span style="text-decoration: underline;">1</span> </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: RsquaredSD &lt;dbl&gt;, MAESD &lt;dbl&gt;</span></span></span></code></pre></div>
<p>We can see that <code>train_smooth_data</code> has given us a number
of accuracy metrics. The first one is ‘RMSE’, which stands for “root
mean squared error” and is often a good default value to use (where
lower values are better) to decide what the best parameter value is.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">training_results</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">window_width_n</span>, y <span class="op">=</span> <span class="va">RMSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Based on this plot, a window_width_n of 1 has the lowest average
error of all the values we tested.</p>
<p>However, often you’ll want to test different values from the defaults
in <code>train_smooth_data</code>. To do so, specify exactly what values
you want to test with the <code>tuneGrid</code> argument:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">training_results</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg_fortraining</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">Well</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="../reference/train_smooth_data.html">train_smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>, </span>
<span>                   sm_method <span class="op">=</span> <span class="st">"moving-average"</span>,</span>
<span>                   tuneGrid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                     <span class="st">"window_width_n"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">9</span>, <span class="fl">13</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">training_results</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">window_width_n</span>, y <span class="op">=</span> <span class="va">RMSE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Here we can see for our example data that cross-validation suggests
little smoothing is necessary. This makes sense, since our example data
has noise that is most problematic for our derivatives, and
cross-validation doesn’t consider the derivatives. For your data, I
suggest combining cross-validation and manual observation of different
smoothings to decide the best smoothing parameter value to use.</p>
</div>
</div>
<div class="section level2">
<h2 id="DerivsOfSmoothed">Calculating derivatives of smoothed data<a class="anchor" aria-label="anchor" href="#DerivsOfSmoothed"></a>
</h2>
<p>Once you’ve smoothed your data, you can calculate derivatives using
the smoothed data. Combining smoothing of raw data and fitting using
multiple points for calculating derivatives can be a powerful
combination for reducing the effects of noise while minimizing the
introduction of bias.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note here that we're calculating derivatives of the smoothed column generated</span></span>
<span><span class="co">#  in the previous section by combining moving median and moving average smoothing</span></span>
<span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span>, <span class="va">noise</span><span class="op">)</span>,</span>
<span>         smderiv_0 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span>,</span>
<span>         smderivpercap_0 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                       percapita <span class="op">=</span> <span class="cn">TRUE</span>, blank <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>         smderiv_3 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smoothed_yes</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>         smderivpercap_3 <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smoothed_yes</span>, percapita <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                    blank <span class="op">=</span> <span class="fl">0</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Reshape our data for plotting purposes</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"smderiv"</span><span class="op">)</span>,</span>
<span>               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deriv"</span>, <span class="st">"window_width_n"</span><span class="op">)</span>, names_sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span></span>
<span><span class="va">ex_dat_mrg_wide</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, names_from <span class="op">=</span> <span class="va">deriv</span>, values_from <span class="op">=</span> <span class="va">value</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smderiv</span>, color <span class="op">=</span> <span class="va">window_width_n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.6</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>,</span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">window_width_n</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 7 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Plot per-capita derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>, <span class="va">noise</span> <span class="op">==</span> <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smderivpercap</span>, color <span class="op">=</span> <span class="va">window_width_n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.6</span>, alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_grey.html" class="external-link">scale_color_grey</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">0.8</span>, end <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg_wide</span>,</span>
<span>                                 <span class="va">noise</span> <span class="op">==</span> <span class="st">"No"</span>, <span class="va">window_width_n</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>            lty <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 8 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="gc07_noise_files/figure-html/unnamed-chunk-13-2.png" width="700"></p>
<p>Here we can see that calculating derivatives from smoothed raw data
can be a powerfully useful combination.</p>
</div>
<div class="section level2">
<h2 id="whats-next">What’s next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h2>
<p>Now that you’ve analyzed your data and dealt with any noise, there’s
just some concluding notes on best practices for running statistics,
merging growth curve analyses with other data, and additional resources
for analyzing growth curves.</p>
<ol style="list-style-type: decimal">
<li>Introduction: <code><a href="../articles/gc01_gcplyr.html">vignette("gc01_gcplyr")</a></code>
</li>
<li>Importing and reshaping data:
<code><a href="../articles/gc02_import_reshape.html">vignette("gc02_import_reshape")</a></code>
</li>
<li>Incorporating experimental designs:
<code><a href="../articles/gc03_incorporate_designs.html">vignette("gc03_incorporate_designs")</a></code>
</li>
<li>Pre-processing and plotting your data:
<code><a href="../articles/gc04_preprocess_plot.html">vignette("gc04_preprocess_plot")</a></code>
</li>
<li>Processing your data: <code><a href="../articles/gc05_process.html">vignette("gc05_process")</a></code>
</li>
<li>Analyzing your data: <code><a href="../articles/gc06_analyze.html">vignette("gc06_analyze")</a></code>
</li>
<li>Dealing with noise: <code><a href="../articles/gc07_noise.html">vignette("gc07_noise")</a></code>
</li>
<li>
<strong>Best practices and other tips:</strong>
<code><a href="../articles/gc08_conclusion.html">vignette("gc08_conclusion")</a></code>
</li>
<li>Working with multiple plates:
<code><a href="../articles/gc09_multiple_plates.html">vignette("gc09_multiple_plates")</a></code>
</li>
<li>Using make_design to generate experimental designs:
<code><a href="../articles/gc10_using_make_design.html">vignette("gc10_using_make_design")</a></code>
</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://mikeblazanin.wordpress.com" class="external-link">Mike Blazanin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
