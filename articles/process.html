<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="gcplyr">
<title>Processing data • gcplyr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Processing data">
<meta property="og:description" content="gcplyr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">gcplyr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.12.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/gcplyr.html">Get started</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/gcplyr.html">Introduction</a>
    <a class="dropdown-item" href="../articles/import_transform.html">Importing and transforming data</a>
    <a class="dropdown-item" href="../articles/preprocess_plot.html">Pre-processing and plotting data</a>
    <a class="dropdown-item" href="../articles/process.html">Processing data</a>
    <a class="dropdown-item" href="../articles/analyze.html">Analyzing data</a>
    <a class="dropdown-item" href="../articles/conclusion.html">Statistics, merging other data, and other resources</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mikeblazanin/gcplyr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Processing data</h1>
                        <h4 data-toc-skip class="author">Mike
Blazanin</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikeblazanin/gcplyr/blob/HEAD/vignettes/process.Rmd" class="external-link"><code>vignettes/process.Rmd</code></a></small>
      <div class="d-none name"><code>process.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Introduction</li>
<li>Importing and transforming data</li>
<li>Incorporating design information</li>
<li>Pre-processing and plotting your data</li>
<li><strong>Processing your data</strong></li>
<li>Analyzing your data</li>
<li>Statistics, merging other data, and other resources</li>
</ol>
<p>If you haven’t already, load the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mikeblazanin.github.io/gcplyr">gcplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ## </span></span>
<span><span class="co">#&gt; ## gcplyr (Version 0.12.1, Build Date: 2023-01-22)</span></span>
<span><span class="co">#&gt; ## See http://github.com/mikeblazanin/gcplyr for additional documentation</span></span>
<span><span class="co">#&gt; ## Please cite software as:</span></span>
<span><span class="co">#&gt; ##   Blazanin, Michael. 2023. 'gcplyr: manipulate and analyze growth</span></span>
<span><span class="co">#&gt; ##   curve data.' R package version 0.12.1</span></span>
<span><span class="co">#&gt; ##</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#This code was explained in sections 2, 3, and 4</span></span>
<span><span class="co">#Here we're re-running it so it's available for us to work with</span></span>
<span><span class="va">example_tidydata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trans_wide_to_tidy.html">trans_wide_to_tidy</a></span><span class="op">(</span><span class="va">example_widedata</span>,</span>
<span>                                       id_cols <span class="op">=</span> <span class="st">"Time"</span><span class="op">)</span></span>
<span><span class="va">example_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_design.html">make_design</a></span><span class="op">(</span></span>
<span>  pattern_split <span class="op">=</span> <span class="st">","</span>, nrows <span class="op">=</span> <span class="fl">8</span>, ncols <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  <span class="st">"Bacteria_strain"</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_designpattern.html">make_designpattern</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Strain"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>    pattern <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">48</span>,</span>
<span>    byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="st">"Bacteria_strain"</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_designpattern.html">make_designpattern</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Strain"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">48</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, cols <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>    pattern <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">48</span>,</span>
<span>    byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="st">"Phage"</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_designpattern.html">make_designpattern</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No Phage"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, cols <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>    pattern <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span>,</span>
<span>  <span class="st">"Phage"</span> <span class="op">=</span> <span class="fu"><a href="../reference/make_designpattern.html">make_designpattern</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Phage Added"</span><span class="op">)</span>,</span>
<span>    rows <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, cols <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>    pattern <span class="op">=</span> <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_dfs.html">merge_dfs</a></span><span class="op">(</span><span class="va">example_tidydata</span>, <span class="va">example_design</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining, by = "Well"</span></span>
<span><span class="va">ex_dat_mrg</span><span class="op">$</span><span class="va">Well</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span><span class="op">$</span><span class="va">Well</span>,</span>
<span>         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="how-to-process-and-analyze-your-data">How to process and analyze your data<a class="anchor" aria-label="anchor" href="#how-to-process-and-analyze-your-data"></a>
</h2>
<p>With your data and design information pre-processed, <strong>your
dataset is now organized in a way that’s easy to export and
analyze</strong>. It is also at this point that the next steps for what
you can do diversify into many options.</p>
<p>Broadly speaking, there are two main approaches to analyzing growth
curves data:</p>
<ol style="list-style-type: decimal">
<li>directly quantify attributes of the growth dynamics</li>
<li>fit the growth dynamics with a mathematical model, then extract
parameters from the fitted model</li>
</ol>
<p>The remaining functions of <code>gcplyr</code> can facilitate
analyses following the first approach: directly quantifying attributes
of the observed dynamics. If you’re interested in exploring
model-fitting approaches, which can provide enormous analytical power,
check out the <strong>[Other growth curve analysis packages]</strong>
section. At this point, since the data is now well-organized, advanced
users may also decide they want to write their own custom analyses (in
lieu of, or alongside, <code>gcplyr</code>-based and/or fitting-based
analyses).</p>
<p>So, how do we directly quantify attributes of growth curves? First,
we may need to carry out smoothing of our data to reduce the effect of
noise. Then, we typically need to calculate derivatives of our
(smoothed) data. The (smoothed) density and (smoothed) derivatives will
be what we analyze to identify features of our growth curves.
<code>gcplyr</code> has a number of functions that facilitate these
steps.</p>
<p>However, unlike the import, transformation, and merging steps we’ve
done so far, different projects may require different analyses, and not
all users will have the same analysis steps. The <strong><a href="#Smoothing">Smoothing</a></strong>, <strong><a href="#CalculatingDerivatives">Calculating Derivatives</a></strong> and
<strong><a href="#Analyzing">Analyzing</a></strong> sections of this
document, therefore, are written to highlight the functions available
and provide examples of common analyses that you may want to run, rather
than prescribing a set of analysis steps that everyone must do.</p>
<p>Before we dig into processing and analyzing our data, we first need
to familiarize ourselves with the <code>dplyr</code> package and its
functions <code>group_by</code> and <code>mutate</code>. Why? Because
the upcoming <code>gcplyr</code> processing functions are <em>best</em>
used <strong>within</strong> <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">dplyr::mutate</a></code>. <strong>If
you’re already familiar with <code>dplyr</code>, feel free to skip this
primer.</strong> If you’re not familiar yet, don’t worry! This section
provides a primer that will teach you all you need to know on using
<code>group_by</code> and <code>mutate</code> with <code>gcplyr</code>
functions.</p>
<div class="section level3">
<h3 id="a-brief-primer-on-dplyr">A brief primer on dplyr<a class="anchor" aria-label="anchor" href="#a-brief-primer-on-dplyr"></a>
</h3>
<p>The <code>R</code> package <code>dplyr</code> provides a “grammar of
data manipulation” that is useful for a broad array of data analysis
tasks (in fact, <code>dplyr</code> is the direct inspiration for the
name of this package!) For our purposes right now, we’re going to focus
on two particular functions: <code>group_by</code> and
<code>mutate</code>.</p>
<p>The <code>mutate</code> function in <code>dplyr</code> allows users
to easily create new columns in their <code>data.frame</code>’s. For us,
we’re going to use <code>mutate</code> to create columns with our
smoothed data and the derivatives we calculate. However, we want to make
sure that smoothing and derivative-calculating are done on <em>each</em>
unique well independently. In order to do that, we’re first going to use
the <code>group_by</code> function, which allows users to group the rows
of their <code>data.frame</code>’s into groups that <code>mutate</code>
will then treat independently.</p>
<p>For growth curves, this means we will:</p>
<ol style="list-style-type: decimal">
<li>
<code>group_by</code> our data so that every unique well is a
group</li>
<li>
<code>mutate</code> to create new columns with our smoothed data and
calculated derivatives</li>
</ol>
<p>Let’s walk through a simple example</p>
<p>For <code>group_by</code>, we need to specify the
<code>data.frame</code> to be grouped, and then we want to list all the
columns needed to identify each unique well in our dataset. Typically,
this includes all of our design columns along with the plate name and
well name. Make sure you’re <em>not</em> grouping by Time, Absorbance,
or anything else that varies <em>within</em> a well, since if you do
<code>dplyr</code> will group timepoints within a well separately.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Well, Bacteria_strain, Phage [6]</span></span></span>
<span><span class="co">#&gt;    Time Well  Measurements Bacteria_strain Phage   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 A1           0.003 Strain 1        No Phage</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     0 B1           0.001 Strain 7        No Phage</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     0 C1           0.002 Strain 13       No Phage</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     0 D1           0.002 Strain 19       No Phage</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     0 E1           0.002 Strain 25       No Phage</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     0 F1           0.001 Strain 31       No Phage</span></span></code></pre></div>
<p>Notice that this hasn’t changed anything about our
<code>data.frame</code>, but <code>R</code> now knows what the groups
are. Now any calculations will be carried out on each unique well
independently.</p>
<p>To use <code>mutate</code>, we simply have to specify:</p>
<ol style="list-style-type: decimal">
<li>the name of the variable we want results saved to</li>
<li>the function that calculates the new column</li>
</ol>
<p>Note that the function has to return a vector that is as long as the
number of data points in the group.</p>
<p>For a simple example, in the code below we’ve simply added one to the
<code>Measurements</code> values and saved it in a column named
<code>Measurements_plus1</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         Measurements_plus1 <span class="op">=</span> <span class="va">Measurements</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Well, Bacteria_strain, Phage [6]</span></span></span>
<span><span class="co">#&gt;    Time Well  Measurements Bacteria_strain Phage    Measurements_plus1</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 A1           0.003 Strain 1        No Phage               1.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     0 B1           0.001 Strain 7        No Phage               1.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     0 C1           0.002 Strain 13       No Phage               1.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     0 D1           0.002 Strain 19       No Phage               1.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     0 E1           0.002 Strain 25       No Phage               1.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     0 F1           0.001 Strain 31       No Phage               1.00</span></span></code></pre></div>
<p>If you want additional columns, you simply add them to the
<code>mutate</code>. For instance, if we also want a column with the
<code>Measurements</code> plus two, we just add that as a second
argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         Measurements_plus1 <span class="op">=</span> <span class="va">Measurements</span><span class="op">+</span><span class="fl">1</span>,</span>
<span>         Measurements_plus2 <span class="op">=</span> <span class="va">Measurements</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 7</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># Groups:   Well, Bacteria_strain, Phage [6]</span></span></span>
<span><span class="co">#&gt;    Time Well  Measurements Bacteria_strain Phage    Measurements_plus1 Measure…¹</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 A1           0.003 Strain 1        No Phage               1.00      2.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     0 B1           0.001 Strain 7        No Phage               1.00      2.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     0 C1           0.002 Strain 13       No Phage               1.00      2.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     0 D1           0.002 Strain 19       No Phage               1.00      2.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     0 E1           0.002 Strain 25       No Phage               1.00      2.00</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     0 F1           0.001 Strain 31       No Phage               1.00      2.00</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable name ¹​Measurements_plus2</span></span></span></code></pre></div>
<p>This is a rather simple example, but in the next sections I show how
we can use <code>mutate</code> with <code>smooth_data</code> and
<code>calc_deriv</code> to create new columns containing smoothed data
and derivatives. If you want to learn more, <code>dplyr</code> has
extensive documentation and examples of its own online. Feel free to
explore them as desired, but this primer and the coming example should
be sufficient to use the <code>gcplyr</code> processing functions, which
(as a reminder) are best used <em>within</em> <code>mutate</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="Smoothing">Processing data: smoothing<a class="anchor" aria-label="anchor" href="#Smoothing"></a>
</h2>
<p>Oftentimes, growth curve data produced by a plate reader will have
some noise it it. While sometimes this noise does not hinder analyses,
sometimes it’s necessary to smooth the data in each well for analyses to
succeed. <code>gcplyr</code> has a <code>smooth_data</code> function
that can carry out such smoothing. Generally you should carry out <em>as
little</em> smoothing as is necessary for your analyses to work. That
means that <strong>right now you should skip this section</strong> and
go on to the <strong><a href="#CalculatingDerivatives">Calculating
Derivatives</a></strong> section, returning to this smoothing section if
your derivatives are too noisy to analyze.</p>
<p>If you have returned in need of learning to use
<code>smooth_data</code>, let’s start by taking a look at a few wells
from our example data, which have some noise.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Here we've chosen four wells that, from our previous plot, seem </span></span>
<span><span class="co"># representative of the overall diversity of dynamics</span></span>
<span><span class="co">#In your own code, you should visualize all your data</span></span>
<span><span class="va">sample_wells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A1"</span>, <span class="st">"F1"</span>, <span class="st">"F10"</span>, <span class="st">"E11"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Plot with a linear y-axis</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Plot with a log y-axis</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>Plotting our data with a log scale for the y-axis is particularly
useful for growth curves because exponential growth is a straight line
when plotted on a log scale.</p>
<p>From the log plot especially we can see that at low densities there’s
a lot of noise relative to the density. In fact, this is a common
occurrence: <strong>at low densities, random noise tends to have a much
larger effect</strong> than at high densities. Unfortunately,
calculating derivatives (especially the per-capita derivative) is very
sensitive to such noise, so let’s smooth our data.</p>
<p><code>smooth_data</code> has four different smoothing algorithms to
choose from: <code>moving-average</code>, <code>moving-median</code>,
<code>loess</code>, and <code>gam</code>.</p>
<ul>
<li>
<code>moving-average</code> is a simple smoothing algorithm that
primarily acts to reduce the effects of outliers on the data</li>
<li>
<code>moving-median</code> is another simple smoothing algorithm
that primarily acts to reduce the effects of outliers on the data</li>
<li>
<code>loess</code> is a spline-fitting approach that uses
polynomial-like curves, which produces curves with smoothly changing
derivatives, but can in some cases create curvature artifacts not
present in the original data</li>
<li>
<code>gam</code> is also spline-fitting approach that uses
polynomial-like curves, which produces curves with smoothly changing
derivatives, but can in some cases create curvature artifacts not
present in the original data</li>
</ul>
<p><strong>Additionally, all four smoothing algorithms have a tuning
parameter</strong> that controls how “smoothed” the data are. For
whichever smoothing method you’re using, <strong>you should plot
smoothing with multiple different tuning parameter values</strong>, then
choose the value that smooths the data as little as is necessary to
reduce noise. Make sure to plot the smoothing for every well in your
data, so that you’re choosing the best setting for all your data and not
just one well.</p>
<p>Smoothing data is a step that alters the values you will analyze.
Because of that, and because there are so many options for how to smooth
your data, it is a step that can be rife with pitfalls. I recommend
starting with the simplest and least “smoothed” smoothing, plotting your
results, and only increasing your smoothing as much as is needed to
enable downstream analyses. Additionally, when sharing your findings,
it’s important to be transparent by sharing the raw data and smoothing
methods, rather than treating the smoothed data as your source.</p>
<p>To use <code>smooth_data</code>, pass your x and y values, your
method of choice, and any additional arguments needed for the method. It
will return a vector of your smoothed y values.</p>
<p>Since we only want to smooth within each unique well, we’ll first
<code>group_by</code> our data:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span>, <span class="va">Bacteria_strain</span>, <span class="va">Phage</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="smoothing-with-moving-average">Smoothing with moving-average<a class="anchor" aria-label="anchor" href="#smoothing-with-moving-average"></a>
</h3>
<p>For <code>moving-average</code>, the tuning parameter is
<code>window_width_n</code>, which specifies how many data points wide
the moving window used to calculate the average is. Specifying the
<code>window_width_n</code> is required, and larger values will be more
“smoothed”. Here, we’ll show moving averages with windows that are 3, 7,
and 11 data points wide (because the window is centered on each data
point, it must be an odd number of data points wide). Note that
<code>moving-average</code> returns <code>NA</code> for the
<code>window_width_n</code>/2 points at the start and end of your
data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         smoothed3 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>              sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>         smoothed7 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>              sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>         smoothed11 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>              sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#What does the smoothed data look like compared to the noisy original?</span></span>
<span><span class="co">#Lighter lines are wider window_width_n's and more "smoothed"</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed3</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed7</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray45"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed11</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray65"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 10 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>Here we can see that <code>moving-average</code> has helped reduce
the effects of some of that early noise. However, with
<code>window_width_n = 11</code> (the lightest line), the smoothing has
started biasing our medium-density data points to be higher than they
actually are. Based on this, we’d probably want to use a
<code>window_width_n</code> less than 11. Unfortunately, with smaller
<code>window_width_n</code> our early data is still being affected by
that early noise, so we should explore other smoothing methods, or try
combining multiple smoothing methods.</p>
</div>
<div class="section level3">
<h3 id="smoothing-with-moving-median">Smoothing with moving-median<a class="anchor" aria-label="anchor" href="#smoothing-with-moving-median"></a>
</h3>
<p>For <code>moving-median</code>, the tuning parameter is also
<code>window_width_n</code>, which specifies how many data points wide
the moving window used to calculate the average is. Specifying the
<code>window_width_n</code> is required, and larger values will be more
“smoothed”. Here, we’ll show moving averages with windows that are 3, 7,
and 11 data points wide (because the window is centered on each data
point, it must be an odd number of data points wide). Note that
<code>moving-median</code> returns <code>NA</code> for the
<code>window_width_n</code>/2 points at the start and end of your
data.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         smoothed3 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>         smoothed7 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>         smoothed11 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">11</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#What does the smoothed data look like compared to the noisy original?</span></span>
<span><span class="co">#Lighter lines are wider window_width_n's and more "smoothed"</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed3</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed7</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray45"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed11</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray65"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 6 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 10 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Here we can see that <code>moving-median</code> has really excluded
that low-density noise, even with the smallest
<code>window_width_n = 3</code>. Additionally,
<code>moving-median</code> did not bias our larger data hardly at all,
except with the widest <code>window_width_n</code>. However, it has
produced a smoothed density that is fairly “jumpy”, something that wider
<code>window_width_n</code> did not fix. <strong>This is common with
moving-median</strong>, so often you may need to try other smoothing
methods or combining <code>moving-median</code> with other methods.</p>
</div>
<div class="section level3">
<h3 id="smoothing-with-loess">Smoothing with LOESS<a class="anchor" aria-label="anchor" href="#smoothing-with-loess"></a>
</h3>
<p>For <code>loess</code>, the tuning parameter is the <code>span</code>
argument. <code>loess</code> works by doing fits on subset windows of
the data centered at each data point. These fits can be linear
(<code>degree = 1</code>) or polynomial (typically
<code>degree = 2</code>). <code>span</code> is the width of the window,
as a fraction of all data points. For instance, with the default
<code>span</code> of 0.75, 75% of the data points are included in each
window. Thus, span values typically are between 0 and 1 (although see
<code><a href="https://rdrr.io/r/stats/loess.html" class="external-link">?loess</a></code> for use of <code>span</code> values greater than 1),
and larger values are more “smoothed”. Here, we’ll show
<code>loess</code> smoothing with spans of 0.1, 0.2, and 0.5 and
<code>degree = 1</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         smoothed1 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                 sm_method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">.1</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>         smoothed2 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                 sm_method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">.2</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>         smoothed5 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                 sm_method <span class="op">=</span> <span class="st">"loess"</span>, span <span class="op">=</span> <span class="fl">.5</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#What does the smoothed data look like compared to the noisy original?</span></span>
<span><span class="co">#Lighter lines are larger span's and more "smoothed"</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed1</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed2</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray45"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray65"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning in self$trans$transform(x): NaNs produced</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning: Removed 9 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Here we can see that <code>loess</code> with smaller spans (darker
lines) have smoothed the data somewhat but are still sensitive to
outliers. However, <code>loess</code> with a larger span (lightest line)
has introduced significant bias. To fix this, we might explore other
smoothing methods, or combining <code>loess</code> with other smoothing
methods.</p>
</div>
<div class="section level3">
<h3 id="smoothing-with-gam">Smoothing with GAM<a class="anchor" aria-label="anchor" href="#smoothing-with-gam"></a>
</h3>
<p>For <code>gam</code>, the primary tuning parameter is the
<code>k</code> argument. <code>gam</code> works by doing fits on subsets
of the data and linking these fits together. <code>k</code> determines
how many link points (“knots”) it can use. If not specified, the default
<code>k</code> value for smoothing a time series is 10, with
<strong>smaller values being more “smoothed”</strong> (note this is
opposite the trend with other smoothing methods). However,
<strong>unlike earlier methods, <code>k</code> values that are too large
are also problematic</strong>, as they will tend to ‘overfit’ the data.
<code>k</code> cannot be larger than the number of data points, and
should usually be substantially smaller than that. Also note that
<strong><code>gam</code> can sometimes create artifacts</strong>,
especially oscillations in your density and derivatives. You should
check that <code>gam</code> is not doing so before carrying on with your
analyses. Here, we’ll show <code>gam</code> smoothing with
<code>k</code> values of 5, 10, and 20.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         smoothed20 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                  sm_method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>         smoothed10 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                  sm_method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>         smoothed5 <span class="op">=</span> <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                                 sm_method <span class="op">=</span> <span class="st">"gam"</span>, k <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#What does the smoothed data look like compared to the noisy original?</span></span>
<span><span class="co">#Lighter lines are smaller k and more "smoothed"</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed20</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed10</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray45"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed5</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray65"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning in self$trans$transform(x): NaNs produced</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning in self$trans$transform(x): NaNs produced</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning in self$trans$transform(x): NaNs produced</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p>Here we can see that <code>gam</code> does alright when working with
the no phage-added wells (A1 and F1): higher <code>k</code> values
(darkest line) have smoothed the data but are still sensitive to those
early outliers, while lower <code>k</code> values (lighter lines) have
introduced significant bias. However, <code>gam</code> is struggling
when phage have been added (E11 and F10). Across all the <code>k</code>
values it has added many fluctuations and often dips into values of 0 or
lower (plotted here as breaks in the line, since the log of numbers
&lt;= 0 are undefined). To fix this, we might explore other smoothing
methods or combining <code>gam</code> with other smoothing methods.</p>
</div>
<div class="section level3">
<h3 id="combining-multiple-smoothing-methods">Combining multiple smoothing methods<a class="anchor" aria-label="anchor" href="#combining-multiple-smoothing-methods"></a>
</h3>
<p>Often, combining multiple smoothing methods can provide improved
results. For instance, <code>moving-median</code> is particularly good
at removing outliers, but not very good at producing continuously smooth
data. In contrast, <code>moving-average</code>, <code>loess</code>, and
<code>gam</code> work better at producing continuously smooth data, but
aren’t as good at removing outliers. Here’s an example using the
strengths of both <code>moving-median</code> and
<code>moving-average</code>. (Note that earlier columns created in
<code>mutate</code> are available during creation of later columns, so
both can be done in one step):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         smoothed_med3 <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">Measurements</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-median"</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>         <span class="co">#Note that for the second round, we're using the </span></span>
<span>         <span class="co">#first smoothing as the input y</span></span>
<span>         smoothed <span class="op">=</span> </span>
<span>           <span class="fu"><a href="../reference/smooth_data.html">smooth_data</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smoothed_med3</span>,</span>
<span>                       sm_method <span class="op">=</span> <span class="st">"moving-average"</span>, window_width_n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#What does the smoothed data look like compared to the noisy original?</span></span>
<span><span class="co">#The first round of smoothing with moving-median is plotted in lighter colors</span></span>
<span><span class="co">#The second round of smoothing with moving-average is plotted in darker colors</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Measurements</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed_med3</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray20"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">smoothed</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"gray65"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Transformation introduced infinite values in continuous y-axis</span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values (`geom_line()`).</span></span>
<span><span class="co">#&gt; Warning: Removed 4 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Here we can see that the combination of minimal
<code>moving-median</code> and <code>moving-average</code> smoothing has
produced a curve that has most of the noise removed with minimal
introduction of bias. (Note that the first and last 2 data points are
now <code>NA</code> because of the smoothing)</p>
</div>
</div>
<div class="section level2">
<h2 id="CalculatingDerivatives">Processing data: calculating derivatives<a class="anchor" aria-label="anchor" href="#CalculatingDerivatives"></a>
</h2>
<p>In many cases, identifying features of a growth curve requires
looking not only at the absorbance data over time, but the slope of the
absorbance data over time. <code>gcplyr</code> includes a
<code>calc_deriv</code> function that can be used to calculate the
empirical derivative (slope) of absorbance data over time.</p>
<p><em>If you’ve previously smoothed your absorbance data, remember to
use those smoothed values rather than the original values!</em></p>
<div class="section level3">
<h3 id="a-simple-derivative">A simple derivative<a class="anchor" aria-label="anchor" href="#a-simple-derivative"></a>
</h3>
<p>To calculate a simple derivative (the slope of our original data)
using <code>calc_deriv</code>, we simply have to provide the x and y
values. Note that this is <strong>not</strong> the growth rate of the
cells, but rather is a measure of how quickly the whole population was
growing at each time point. This is useful for identifying events like
population declines, or multiple rounds of growth.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>                     deriv <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smoothed</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Now let's plot the derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">deriv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 5 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Here we can clearly see when the slope of the total population was
increasing the fastest, and when it declines in the phage-added wells.
But we can also see something surprising in Well A1 that may not have
been immediately apparent visually: there is a second, slower, burst of
growth later on. Such a pattern is common in bacterial growth curves and
is called <em>diauxic growth</em>. Additionally, we can see in Well E11
when the bacteria start to grow again following near-extinction by
phages, presumably after evolving resistance to the phage. (Note that
the last value in the time series always becomes <code>NA</code> with
<code>calc_deriv</code> under default settings)</p>
</div>
<div class="section level3">
<h3 id="per-capita-derivative">Per-capita derivative<a class="anchor" aria-label="anchor" href="#per-capita-derivative"></a>
</h3>
<p>If we want to calculate the growth rate of the cells, we need to use
<code>calc_deriv</code> to return the <strong>per-capita</strong>
derivative. Just as before, provide the x and y values, but now set
<code>percapita = TRUE</code>. Note that in this case, you are required
to specify a blank value, i.e. the value of your
<code>Measurements</code> that corresponds to a population density of 0.
If your data have already been normalized, simply add
<code>blank = 0</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>                     deriv_percap <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smoothed</span>,</span>
<span>                                        percapita <span class="op">=</span> <span class="cn">TRUE</span>, blank <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Now let's plot the per-capita derivative</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">deriv_percap</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 5 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<p>Here we can see that, in Well A1, the per-capita growth rate peaked
much earlier in the time-series than might appear from the density
dynamics or non per-capita derivative. We can also see that there was
clearly a lag phase at the beginning before the bacteria started growing
rapidly.</p>
<p>However, the other wells seem to have a lot of noise obscuring their
per-capita growth rates. What happened? Why hasn’t our smoothing been
sufficient? As I explore later, per-capita growth rates can be strongly
affected by even small noise at very low densities, something that can
be excluded simply by only analyzing per-capita growth when densities
are above some minimum value.</p>
</div>
<div class="section level3">
<h3 id="changing-the-derivative-units">Changing the derivative units<a class="anchor" aria-label="anchor" href="#changing-the-derivative-units"></a>
</h3>
<p>To convert your x-axis (time) units in your derivative calculations
to a different unit, use the <code>x_scale</code> argument. Simply
specify the ratio of your x units to the desired units. For instance, in
our example data <code>x</code> is the number of <em>seconds</em> since
the growth curve began. What if we wanted growth rate in
<em>per-hour</em>? There are 3600 seconds in an hour, so we set
<code>x_scale = 3600</code></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex_dat_mrg</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>,</span>
<span>         deriv_percap_hr <span class="op">=</span> <span class="fu"><a href="../reference/calc_deriv.html">calc_deriv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">smoothed</span>,</span>
<span>                                      percapita <span class="op">=</span> <span class="cn">TRUE</span>, blank <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                      x_scale <span class="op">=</span> <span class="fl">3600</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Now let's plot the derivative in units of Abs/hour</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ex_dat_mrg</span>, <span class="va">Well</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">sample_wells</span><span class="op">)</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Time</span>, y <span class="op">=</span> <span class="va">deriv_percap_hr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Well</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 5 rows containing missing values (`geom_line()`).</span></span></code></pre></div>
<p><img src="process_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>Now we can see the bacterial growth rate in more-understandable
units: peak growth rates are often around 1-2 times/hour (when ignoring
the points that seem likely to be noise).</p>
</div>
</div>
<div class="section level2">
<h2 id="whats-next">What’s next?<a class="anchor" aria-label="anchor" href="#whats-next"></a>
</h2>
<p>Now that you’ve processed your data, you’re ready to analyze it!</p>
<ol style="list-style-type: decimal">
<li>Introduction</li>
<li>Importing and transforming data</li>
<li>Incorporating design information</li>
<li>Pre-processing and plotting your data</li>
<li><strong>Processing your data</strong></li>
<li>Analyzing your data</li>
<li>Statistics, merging other data, and other resources</li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://mikeblazanin.wordpress.com" class="external-link">Mike Blazanin</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
